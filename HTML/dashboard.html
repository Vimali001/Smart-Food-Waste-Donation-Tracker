<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Food Tracker</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <nav>
        <div class="nav-container">
            <div class="logo">üçΩÔ∏è FoodTracker</div>
            <ul class="nav-links">
                <li><a href="/dashboard.html">Dashboard</a></li>
                <li><a href="/foodlist.html">My Food Items</a></li>
                <li><a href="/addfood.html">Add Food</a></li>
                <li><a href="/donations_status.html">Donations</a></li>
                <li><a href="#" onclick="logout()">Logout</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <h1>Welcome, <span id="userName"></span>!</h1>
        
        <div class="dashboard-grid">
            <div class="stat-card">
                <h3 id="totalItems">0</h3>
                <p>Total Food Items</p>
            </div>
            <div class="stat-card">
                <h3 id="expiringSoon">0</h3>
                <p>Expiring Soon</p>
            </div>
            <div class="stat-card">
                <h3 id="activeItems">0</h3>
                <p>Active Items</p>
            </div>
            <div class="stat-card">
                <h3 id="totalDonations">0</h3>
                <p>Total Donations</p>
            </div>
        </div>

        <div class="card mt-20">
            <h2 class="card-header">Expiring Soon (Next 2 Days)</h2>
            <div id="expiringItems"></div>
        </div>

        <div class="card mt-20">
            <h2 class="card-header">Recipe Suggestions</h2>
            <div id="recipeSuggestions" class="recipe-grid"></div>
        </div>

        <div class="card mt-20">
            <h2 class="card-header">Quick Actions</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;">
                <a href="/addfood.html" class="btn btn-primary">Add Food Item</a>
                <a href="/foodlist.html" class="btn btn-info">View All Items</a>
                <a href="/donations_status.html" class="btn btn-warning">My Donations</a>
            </div>
        </div>
    </div>

    <script src="/js/api.js"></script>
    <script>
        async function loadDashboard() {
            try {
                // Get current user
                const user = await userAPI.getCurrent();
                if (user && user.name) {
                    document.getElementById('userName').textContent = user.name;
                }

                // Load food items
                const items = await foodAPI.getAll();
                document.getElementById('totalItems').textContent = items.length || 0;
                
                const activeItems = items.filter(item => item.status === 'ACTIVE');
                document.getElementById('activeItems').textContent = activeItems.length || 0;

                // Load expiring soon items
                const expiring = await foodAPI.getExpiringSoon(2);
                document.getElementById('expiringSoon').textContent = expiring.length || 0;

                // Display expiring items
                const expiringContainer = document.getElementById('expiringItems');
                if (expiring.length === 0) {
                    expiringContainer.innerHTML = '<p>No items expiring soon!</p>';
                } else {
                    expiringContainer.innerHTML = expiring.map(item => `
                        <div class="food-card expiring">
                            <h4>${item.itemName}</h4>
                            <p>Quantity: ${item.quantity}</p>
                            <p>Expires: ${formatDate(item.expiryDate)}</p>
                            <div class="expiry-alert alert alert-warning">‚ö†Ô∏è Expiring Soon!</div>
                        </div>
                    `).join('');
                }

                // Load recipe suggestions
                const recipes = await recipeAPI.suggest();
                const recipeContainer = document.getElementById('recipeSuggestions');
                if (recipes.length === 0) {
                    recipeContainer.innerHTML = '<p>No recipe suggestions available. Add some food items to get suggestions!</p>';
                } else {
                    recipeContainer.innerHTML = recipes.slice(0, 6).map(recipe => `
                        <div class="recipe-card">
                            <h4>${recipe.recipeName}</h4>
                            <p>${recipe.description || ''}</p>
                            <p><strong>Category:</strong> ${recipe.category}</p>
                        </div>
                    `).join('');
                }

                // Load donations
                const donations = await donationAPI.getUserDonations();
                document.getElementById('totalDonations').textContent = donations.length || 0;

            } catch (error) {
                console.error('Error loading dashboard:', error);
                window.location.href = '/login.html';
            }
        }

        async function logout() {
            try {
                await userAPI.logout();
                clearAuthInfo();
                window.location.href = '/index.html';
            } catch (error) {
                console.error('Logout error:', error);
                clearAuthInfo();
                window.location.href = '/index.html';
            }
        }

        loadDashboard();
    </script>
</body>
</html>

